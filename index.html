<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q&A Generator</title>
    <link rel="icon" href="review.ico">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <script>
        // Hide content if not in /test path (only on production/Netlify)
        // Allow local development (localhost, 127.0.0.1, file://) and Netlify /test path
        const isLocal = window.location.hostname === 'localhost' || 
                       window.location.hostname === '127.0.0.1' || 
                       window.location.protocol === 'file:';
        const isNetlifyTestPath = window.location.hostname.includes('netlify') && window.location.pathname.startsWith('/test');
        
        if (!isLocal && !isNetlifyTestPath && window.location.hostname.includes('netlify')) {
            document.body.style.display = 'none';
            document.body.innerHTML = '<div class="not-found-message">404 - Page not found</div>';
            document.body.style.display = 'block';
        }
    </script>
    
    <!-- Login Interface (Initial State) -->
    <div id="loginInterface" class="login-container">
        <div class="login-box">
            <h1>Q&A Generator</h1>
            <input type="text" id="userName" placeholder="Enter your name (shown on host page)">
            <button onclick="login()">Login</button>
        </div>
    </div>

    <!-- Owner Dashboard (After Owner Login) -->
    <div id="ownerDashboard" class="owner-container hide">
        <div class="header">
            <div class="header-left">
                <h2>Owner Dashboard#5</h2>
                <span id="ownerName" class="owner-email"></span>
            </div>
            <div class="header-right">
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>
        
        <div class="owner-controls">
            <div class="test-selector">
                <label for="tests">Select Quiz:</label>
                <select id="tests" onchange="loadQuizPreview()"></select>
                <button id="loadQuizBtn" onclick="loadQuiz()" class="generate-btn">Load Quiz</button>
            </div>
            
            <!-- Quiz Preview Section -->
            <div id="quizPreview" class="quiz-preview hide">
                <h3>Quiz Preview (Original Order)</h3>
                <div id="previewContent"></div>
            </div>
            
            <div id="sessionInfo" class="session-info hide">
                <h3>Active Session</h3>
                <div id="sessionDetails"></div>
                <button onclick="endQuizSession()" class="end-session-btn">End Session</button>
            </div>
            
            <div id="startSessionInfo" class="session-info">
                <h3>No Active Session</h3>
                <p>Load a quiz and click "Start Session" to allow clients to join.</p>
                <button onclick="startNewSession()" class="start-session-btn">Start Session</button>
            </div>
        </div>
        
        <!-- Client Monitoring Section -->
        <div id="clientMonitoring" class="client-monitoring hide">
            <h3>Client Submissions</h3>
            <div class="monitoring-controls">
                <button onclick="refreshSubmissions()" class="refresh-btn">Refresh</button>
                <span id="submissionCount" class="submission-count">No submissions yet</span>
            </div>
            <div id="submissionsList" class="submissions-list"></div>
        </div>
    </div>

    <!-- Client Quiz Interface (Dynamic, When Session Active) -->
    <div id="clientInterface" class="client-container hide">
        <div class="header">
            <div class="header-top">
                <div class="header-left">
                    <h2 class="quiz-name" id="quizName">Waiting for Quiz...</h2>
                </div>
                <div class="header-right">
                    <div class="score-label" id="scoreLabel"></div>
                </div>
            </div>
            <div class="header-bottom">
                <button class="submit-btn" id="submitBtn" onclick="submitAnswers()">Submit</button>
                <button class="print-btn" id="printBtn" onclick="printQuiz()">Print</button>
                <button class="share-btn" id="shareBtn" onclick="shareQuiz()">Share</button>
            </div>
        </div>
        
        <hr class="header-separator">
        
        <!-- Quiz Status -->
        <div id="quizStatus" class="quiz-status">
            <div class="status-message">Waiting for owner to start a quiz session...</div>
        </div>
        
        <!-- Questions Container -->
        <div id="questionsContainer"></div>
    </div>

    <!-- 404 Interface (For Non-owners When No Session) -->
    <div id="notFoundInterface" class="not-found-container hide">
        <div class="error-container">
            <h1>404</h1>
            <p>The page you're looking for doesn't exist.</p>
            <a href="#" onclick="showLogin()">‚Üê Back to Login</a>
        </div>
    </div>

    <script src="collections/config.js"></script>
    <script src="js/common.js"></script>
    <script src="js/owner.js"></script>
    <script src="js/client.js"></script>
    <script>
        // Main application logic
        let currentUser = '';
        let currentUserRole = '';
        
        // Simple login function
        function login() {
            const userName = document.getElementById('userName').value.trim();
            if (!userName) {
                alert('Please enter your name.');
                return;
            }
            
            console.log('Login attempt for:', userName);
            currentUser = userName;
            sessionStorage.setItem('userName', userName);
            
            // Check if user is owner using the isValidOwner function from config.js
            const isOwner = typeof isValidOwner === 'function' && isValidOwner(userName);
            console.log('Is owner check result:', isOwner);
            
            if (isOwner) {
                currentUserRole = 'owner';
                console.log('User is owner, showing dashboard');
                showOwnerDashboard();
            } else {
                currentUserRole = 'client';
                console.log('User is client, checking for active session');
                // Check if there's an active quiz session
                const activeSession = getQuizSession();
                console.log('Active session check result:', activeSession);
                if (activeSession) {
                    console.log('Active session found, showing client interface');
                    showClientInterface();
                } else {
                    console.log('No active session, showing 404');
                    show404Page();
                }
            }
        }
        
        // Show owner dashboard
        function showOwnerDashboard() {
            hideAllInterfaces();
            document.getElementById('ownerDashboard').classList.remove('hide');
            
            // Initialize owner dashboard
            if (typeof initializeOwnerDashboard === 'function') {
                initializeOwnerDashboard(currentUser);
            }
        }
        
        // Show client interface
        function showClientInterface() {
            hideAllInterfaces();
            document.getElementById('clientInterface').classList.remove('hide');
            
            // Initialize client interface
            if (typeof initializeClientInterface === 'function') {
                initializeClientInterface(currentUser);
            }
        }
        
        // Show 404 page
        function show404Page() {
            hideAllInterfaces();
            document.getElementById('notFoundInterface').classList.remove('hide');
        }
        
        // Show login page
        function showLogin() {
            hideAllInterfaces();
            document.getElementById('loginInterface').classList.remove('hide');
        }
        
        // Hide all interfaces
        function hideAllInterfaces() {
            document.getElementById('loginInterface').classList.add('hide');
            document.getElementById('ownerDashboard').classList.add('hide');
            document.getElementById('clientInterface').classList.add('hide');
            document.getElementById('notFoundInterface').classList.add('hide');
        }
        
        // Logout function
        function logout() {
            const wasOwner = currentUserRole === 'owner';
            
            sessionStorage.removeItem('userName');
            currentUser = '';
            currentUserRole = '';
            
            // Clear any active sessions if owner
            if (wasOwner && typeof clearQuizSession === 'function') {
                console.log('Owner logging out, clearing session');
                clearQuizSession();
            }
            
            showLogin();
        }
        
        // Allow Enter key to trigger login
        document.getElementById('userName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                login();
            }
        });
        
        // Check for existing session on page load
        window.addEventListener('load', function() {
            const savedUser = sessionStorage.getItem('userName');
            if (savedUser) {
                currentUser = savedUser;
                // Re-login with saved user
                login();
            }
        });
    </script>
</body>
</html> 