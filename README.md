# Q&A Generator - 实时问答平台

一个现代化的实时问答平台，支持多种压缩格式上传，具备实时监控功能，基于 Firebase 后端。提供管理员后台和用户答题界面。

## ✨ 主要功能

### 🎯 **实时问答系统**
- **管理员后台**：上传、管理问卷，实时监控答题情况
- **用户答题界面**：交互式答题体验，即时反馈
- **实时监控**：实时追踪参与者答案和统计数据
- **会话管理**：开始/结束答题会话，参与者追踪

### 📱 **移动优先设计**
- **100% 移动优化**：专为移动设备优化设计
- **触摸友好界面**：大按钮和直观导航
- **响应式布局**：在所有屏幕尺寸上完美工作
- **渐进式网页应用**：快速加载和离线功能

### 🚀 **高级功能**
- **多格式支持**：上传 ZIP、7Z、TAR.GZ、GZ 压缩包
- **图片共享**：高效的共享图片存储系统
- **实时同步**：基于 Firebase 的实时数据同步
- **智能随机化**：问题和选项随机打乱，公平评估
- **级联删除**：全面的数据清理和一致性维护

## 如何使用

### 管理员操作流程
1. **登录**：输入管理员凭据（在 `data/owners.json` 中配置）
2. **上传问卷**：使用压缩包上传创建新问卷
3. **管理问卷**：查看、选择和删除现有问卷
4. **开始会话**：启动问卷会话供用户参与
5. **实时监控**：观看实时参与者统计和答案
6. **结束会话**：停止会话并可选择保留数据

### 用户操作流程
1. **登录**：输入姓名加入活跃会话
2. **答题**：回答带图片的多选题
3. **实时提交**：选择后答案立即提交
4. **即时反馈**：查看结果和正确答案高亮
5. **会话感知**：自动检测活跃的问卷会话

## 项目结构

```
/
├── index.html              # 主应用入口
├── styles.css              # 移动优先响应式样式
├── js/                     # JavaScript 模块
│   ├── firebase_service.js # Firebase 后端集成
│   ├── quiz_upload.js      # 问卷上传和处理
│   ├── owner_service.js    # 管理员认证和管理
│   ├── owner.js            # 管理员后台功能
│   ├── client.js           # 用户答题界面
│   └── common.js           # 共享工具函数
├── data/
│   └── owners.json         # 管理员配置和权限
├── js7z/                   # 压缩包解压库
│   ├── js7z.js            # JS7z 主库
│   └── js7z.wasm          # WebAssembly 二进制文件
├── netlify.toml            # Netlify 部署配置
├── 404.html                # 自定义 404 错误页面
└── README.md               # 本文件
```

## 问卷包格式

上传包含以下内容的压缩包：

### 必需文件：
- **quiz.csv**：CSV 格式的问题和答案
- **images/**：包含图片文件的文件夹（可选）

### CSV 结构：
```csv
"2+2等于多少？","天空是什么颜色？","哪个更大？"
"calc.jpg","sky.jpg","elephant.jpg"
"`4","蓝色","大象"
"3","`蓝色","`大象"
"5","绿色","老鼠"
"6","红色","猫"
```

**格式规则：**
- **基于列**：每列代表一个问题
- **第1行**：问题文本
- **第2行**：图片文件名（可选，无图片留空）
- **第3行及以下**：答案选项
- **正确答案**：用反引号 `` ` `` 前缀标记（例如：`` `4 ``）
- **问题类型**：单个正确答案=单选，多个正确答案=多选

### 支持的压缩格式：
- **ZIP** (.zip)
- **7-Zip** (.7z)
- **Gzip** (.gz)
- **Tar Gzip** (.tar.gz, .tgz)

## 配置说明

### 管理员配置
编辑 `data/owners.json` 来配置授权管理员：

```json
{
  "owners": [
    {
      "username": "admin@example.com",
      "displayName": "主管理员",
      "role": "admin",
      "permissions": ["create_quiz", "manage_sessions", "view_analytics", "delete_quiz", "manage_owners"],
      "isActive": true
    }
  ],
  "settings": {
    "allowNewOwnerRegistration": false,
    "defaultPermissions": ["create_quiz", "manage_sessions"],
    "sessionTimeout": 3600000,
    "maxQuizzesPerOwner": 50
  }
}
```

### Firebase 配置
Firebase 配置已嵌入到应用代码中：
- **Firestore**：问卷和会话的实时数据库
- **Storage**：共享图片存储系统
- **安全规则**：配置读写访问权限

## 快速开始

### 1. 管理员首次使用
1. 修改 `data/owners.json` 添加你的管理员账户
2. 访问 [https://gostnort-review.netlify.app/](https://gostnort-review.netlify.app/)
3. 输入你在 owners.json 中配置的用户名登录
4. 上传你的第一个问卷压缩包

### 2. 创建问卷包
1. 准备 CSV 文件，按照上述格式编写问题
2. 准备图片文件（JPG/PNG格式）
3. 将 CSV 和图片打包成 ZIP 文件
4. 在管理员后台上传

### 3. 开始答题会话
1. 在管理员后台选择问卷
2. 点击"开始会话"
3. 分享链接给用户参与答题
4. 实时监控答题进度

## 技术架构

### Firebase 后端
- **Firestore 集合**：
  - `quizzes`：问卷数据和问题
  - `sessions`：活跃问卷会话
  - `shared_images`：高效图片存储
  - `users/{userName}/answers`：用户专属答案集合

### 实时功能
- **实时监控**：管理员实时查看参与者答案
- **会话管理**：自动会话检测和更新
- **参与者追踪**：实时客户端计数和参与统计
- **数据同步**：Firebase onSnapshot 实现实时更新

### 压缩包处理
- **JS7z 集成**：基于 WebAssembly 的压缩包解压
- **多格式支持**：处理 ZIP、7Z、GZ、TAR.GZ 格式
- **客户端处理**：无需服务器端依赖
- **进度追踪**：实时上传和处理反馈

## 部署说明

### Netlify 部署
1. 将 GitHub 仓库连接到 Netlify
2. 配置构建设置：
   - **构建命令**：无（静态站点）
   - **发布目录**：`.`（根目录）
3. 推送代码自动部署

### 环境配置
- **无需环境变量**：Firebase 配置已嵌入
- **静态托管兼容**：完全客户端运行
- **CDN 优化**：快速全球内容交付

## 浏览器兼容性

- **现代浏览器**：Chrome 80+、Safari 13+、Firefox 75+、Edge 80+
- **移动端支持**：iOS Safari 13+、Chrome Mobile 80+
- **需要 WebAssembly**：用于压缩包解压功能
- **需要 JavaScript**：完整功能需要现代 JavaScript

## 常见问题

### 问卷上传问题
- 验证压缩包包含 `quiz.csv` 文件
- 检查 CSV 格式是否符合规范
- 确保图片文件是网络兼容格式（JPG、PNG）
- 查看浏览器控制台获取详细错误信息

### Firebase 连接问题
- 验证 Firebase 配置是否正确
- 检查浏览器网络标签查看连接错误
- 确保 Firestore 安全规则允许访问
- 清除浏览器缓存并重新加载

### 压缩包解压错误
- 确保浏览器支持 WebAssembly
- 如果一种格式失败，尝试不同的压缩格式
- 检查 JS7z 库文件是否可访问
- 验证压缩包未损坏

### 实时同步问题
- 检查 Firebase 项目状态
- 验证网络连接稳定性
- 刷新页面重新建立连接
- 检查浏览器控制台查看 WebSocket 错误

## 性能优化

- **共享图片存储**：消除重复图片上传
- **高效数据结构**：优化的 Firestore 文档组织
- **实时订阅**：onSnapshot 最小化数据传输
- **移动优先加载**：针对移动网络条件优化

## 示例问卷

项目包含了示例问卷文件 `sample_quiz.zip`，您可以：
1. 下载并解压查看格式
2. 直接上传测试系统功能
3. 参考其 CSV 结构创建自己的问卷

---

**版本**：v2.0 | **Firebase 后端** | **实时平台** | **移动优先** | **多格式支持** | **许可证**：MIT

**在线演示**：[https://gostnort-review.netlify.app/](https://gostnort-review.netlify.app/)

**技术支持**：如有问题，请检查浏览器控制台错误信息，或参考项目中的 `requirement_detail.md` 技术文档。